var CengageFlashcardsApp=function(){function a(a){if(P(),a){var t=[];for(G=1,$(".flashcards .ui-icon-fc-shuffle").addClass("lit");M.length>1;){var e=Math.floor(Math.random()*M.length);t.push(M.splice(e,1)[0])}t.push(M[0]),M=t,r(!0)}else G=0,$(".flashcards .ui-icon-fc-shuffle").removeClass("lit"),M.sort(function(a,t){return a.idx-t.idx}),r()}function t(){if(F.length){var a=M.indexOf(B);q.push(M.splice(a,1)[0]),a===M.length-2&&--a,B=M[a],r()}}function e(){M=M.concat(q),G||a(!1),q=[],r()}function i(a){var t=F.indexOf(B),e=t+a;e=0>e?F.length-1:e==F.length?0:e,B=F[e],n(),f(),v()}function s(a){var t=$(a.target).is("img")?$(a.target).parent():a.target,e=$(".thumb-images div").index(t);B=F[e],n(),f(),v()}function n(){h(),l(),v(),b()}function r(a){if(F=M.slice(),999!=N&&(F=F.filter(function(a){return a.chapter==N})),F.length){c(!1);("undefined"==typeof B||-1==F.indexOf(B)||a)&&(B=F[0]),n()}else c(!0);o(),f(),d(),y(),I()}function c(a){a?($(".flashcards .content").hide(),$(".flashcards .no-cards-msg").show(),$(".flashcards .no-cards-msg").top=$("body").height()/2):($(".flashcards .content").show(),$(".flashcards .no-cards-msg").hide())}function l(){var a=$(".flashcards .review-content");a.find(".artist ul li").html(B.artist),a.find(".title ul li").html(B.title),a.find(".description ul li").html(B.extended_caption),a.find(".year ul li").html(B.year),a.find(".medium ul li").html(B.medium),a.find(".dimensions ul li").html(B.dimensions)}function h(){P();var a=(B.chapter<10?"ch0":"ch")+B.chapter,t=H.imageBasePath+a+"/"+H.screenwidth+"/"+B.filename,e=$(".flashcards .image .img0");"undefined"==typeof e.attr("src")||e.attr("src").split("/").pop().split(".")[0]!=t.split("/").pop()?e.attr({src:t+".jpg",alt:B.title}):j()}function o(){for(var a=$("<div class='thumb-images' />"),t=0;t<F.length;t++){var e=(F[t].chapter<10?"ch0":"ch")+F[t].chapter,i=H.imageBasePath+e+"/thmb/"+F[t].filename,n=$("<div/>").append($("<img class='lazy'>").attr({"data-original":i+".jpg",alt:F[t].title,"data-idx":F.idx})).click(function(a){s(a)});a.append(n)}$(".flashcards .thumbs .thumb-images").remove(),$(".flashcards .thumbs").append(a),$(".flashcards .thumbs img.lazy").lazyload({container:$(".flashcards .thumbs"),skip_invisible:!1})}function f(){$(".flashcards .thumbs .thumb-images div").removeClass("lit");var a=F.indexOf(B);$(".flashcards .thumbs .thumb-images div").eq(a).addClass("lit")}function d(){if($(".flashcards .search-input").val().length){var a="chapter "+N;999==N&&(a="all chapters"),"0"===N&&(a="introduction"),$(".flashcards .currently-viewing-val").html(a),$(".flashcards .matches-all").text(M.length),$(".flashcards .matches-chapter").text(F.length)}}function u(){if(!L){L=lunr(function(){for(var a in D[0]){if("filename"!=a){var t=1;"title"==a&&(t=20),"extended_caption"==a&&(t=10),"artist"==a&&(t=5),this.field(a,{boost:t})}this.ref("filename")}});for(var a=0;a<D.length;a++)L.add(D[a])}j()}function m(){if(V.text=$(".flashcards .search-input").val(),V.text.length){for(var a=L.search(V.text),t=[],e=0;e<a.length;e++)for(var i=0;i<D.length;i++)if(a[e].ref==D[i].filename){t.push(D[i]);break}M=t,x(V.isActive=!0)}else M=D.slice(),x(V.isActive=!1),V.text="";for(var i=0;i<q.length;i++)for(var e=0;e<M.length;e++)q[i].filename==M[e].filename&&M.splice(e,1);r(!0)}function p(){N=$(".flashcards .menu-chapter select").val(),r(!0)}function g(){$(".titlebar .menu-chapter select").val(N),$(".titlebar .menu-chapter select").selectmenu("refresh")}function v(){var a=F.indexOf(B);$(".flashcards .card-pos").html("Card "+(a+1)+" of "+F.length)}function b(){var a=""==B.credit?"":",";$(".flashcards .image .figure").html("<span class='number'>"+B.figure+a+"</span><span class='credit'>&#160;"+B.credit+"</span>")}function y(){$(".flashcards .hidden-count").html(q.length||"")}function x(a){a?($(".flashcards .search-input").val(V.text),$(".flashcards .ui-input-search .ui-input-clear").show(),$(".flashcards .search-output").fadeIn()):$(".flashcards .search-output").fadeOut()}function w(a){a?($(".flashcards .titlebar").animate({opacity:1}),$(".flashcards .thumbs").animate({opacity:1}),V.isActive&&x(!0),E&&$(".flashcards .mobile-menu-btn").hide()):($(".flashcards .titlebar").animate({opacity:0}),$(".flashcards .thumbs").animate({opacity:0}),x(!1),E&&$(".flashcards .mobile-menu-btn").show())}function C(a){a?($(".flashcards .prev").animate({opacity:1}),$(".flashcards .next").animate({opacity:1})):($(".flashcards .prev").animate({opacity:0}),$(".flashcards .next").animate({opacity:0}))}function k(){var a,t;try{t=new Date,(J=window.localStorage).setItem(t,t),a=storage.getItem(t)!=t,J.removeItem(t)}catch(e){}}function I(){if(J){for(var a=[],t={},e=0;e<q.length;e++)for(var i=0;i<D.length;i++)q[e].filename==D[i].filename&&a.push(i);t.isShuffled=G,t.currentChapter=N,t.searchState=V,t.hiddenCards=a.sort(function(a,t){return a-t});try{var s=H.product+"_"+H.initialChapter;J.setItem(s,JSON.stringify(t))}catch(n){console.log("Error saving localStorage: "+n)}}}function S(){if(M=D.slice(),q=[],J){try{var t=H.product+"_"+H.initialChapter,e=JSON.parse(J.getItem(t))}catch(i){console.log("Error loading localStorage: "+i)}if(e){N=e.currentChapter,G=e.isShuffled;for(var s=0;s<e.hiddenCards.length;s++)q.push(M.splice(e.hiddenCards[s]-s,1)[0]);H.externalInit&&(N=H.initialChapter),G&&($(".flashcards .ui-icon-fc-shuffle").addClass("lit"),a(!0)),"undefined"!=typeof e.searchState&&"undefined"!=typeof e.searchState.text&&(V=e.searchState,$(".flashcards .search-input").val(V.text),m())}g()}}function _(){navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0&&$(".ui-mobile, .ui-mobile body").css("height","98%");var a=$(".flashcards .image .img0"),t=5,e=$("body").height()-$(".flashcards .image .figure").height()-$(".flashcards .image .card-pos").height()-2*t-2;a.css("max-height",e),a.width()/a.height()>1?a.css("margin-top",(e-a.height())/2):a.css("margin-top",0);var i=$(".flashcards .titlebar");$(".flashcards .search-output").css("top",i.height()-t),$(".flashcards .flip-img-layer img").css("margin-top",e/2),$(".flashcards .main").height($("body").height()-2*t);var s=$(".flashcards .watermark").width(),n=$(".flashcards .watermark-txt").width();$(".flashcards .watermark-txt").css("right",(n-s)/2*-1);var s=$(window).width();H.screenwidth=800>s?"sm":1060>s?"md":"lg"}function O(){{var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,i){a[e]=i})}return a}function P(a){var t={};a&&(t.text=a,t.textVisible=!0),$.mobile.loading("show",t)}function j(){$.mobile.loading("hide")}function A(){w(!1),$(".flashcards .main").toggleClass("flip"),$(".flashcards .main.flip").length?$(".flashcards .watermark").delay(200).fadeIn():$(".flashcards .watermark").hide()}function z(){$(".flashcards .main").click(function(){$(".flashcards .titlebar").css("opacity")>0?(w(!1),C(!1)):A()}),E="ontouchstart"in window||navigator.msMaxTouchPoints,E?($(".flashcards").addClass("mobile"),$(".flashcards .main").on("swipeleft",function(){i(1),w(!1)}).on("swiperight",function(){i(-1),w(!1)}),$(".flashcards .mobile-menu-btn").tap(function(){w(!0)})):($(".flashcards .prev").mouseenter(function(){C(!0)}).mouseleave(function(){C(!1)}),$(".flashcards .next").mouseenter(function(){C(!0)}).mouseleave(function(){C(!1)}),$(".flashcards .search-output").mouseenter(function(){clearTimeout($(this).data("timeoutId"))}).mouseleave(function(){timeoutId=setTimeout(function(){w(!1)},200),$(this).data("timeoutId",timeoutId)}),$(".flashcards .titlebar").mouseleave(function(){$(".titlebar .menu-chapter select").is(":focus")||(timeoutId=setTimeout(function(){w(!1)},200),$(".flashcards .search-output").data("timeoutId",timeoutId))}).mouseenter(function(){clearTimeout($(".flashcards .search-output").data("timeoutId")),w(!0)}),$(".flashcards .thumbs").mouseleave(function(){w(!1)}).mouseenter(function(){w(!0)})),$(".flashcards .prev-arrow").click(function(){return i(-1),!1}).mouseover(function(){w(!1)}),$(".flashcards .next-arrow").click(function(){return i(1),!1}).mouseover(function(){w(!1)}),$(".titlebar .menu-chapter").change(function(){p()}),$("body").keydown(function(a){return $(".flashcards .flip-img-layer:visible").length?($(".flashcards .flip-img-layer").hide(),void $(".flashcards .main").click()):void(37==a.keyCode?(i(-1),C(!1),w(!1)):39==a.keyCode?(i(1),C(!1),w(!1)):(38==a.keyCode||40==a.keyCode)&&A())}),$(".flashcards .search-input").change(function(){$(".flashcards .search-input").blur(),m()}),$(".flashcards .shuffle").click(function(){a(!G)}),$(".flashcards .remove").click(function(){t()}),$(".flashcards .show").click(function(){e()}),$(".flashcards .flip-img-layer").click(function(){$(this).hide(),$(".flashcards .main").click()}),$(".flashcards .match-btn").click(function(){$(".titlebar .menu-chapter select option:eq(0)").prop("selected",!0),$(".titlebar .menu-chapter select").selectmenu("refresh"),p()}),$(document).mouseup(function(a){var t=$(".flashcards .menu-chapter select");$(a.target).is(t)||$(a.target).is(t.find("option"))||t.blur()})}function T(a){P("initializing...");var t=a||{};t=$.extend(t,O()),Object.keys(t).length&&($.extend(H,t),H.externalInit="undefined"!=typeof t.initialChapter),N=isNaN(parseInt(H.initialChapter))?999:H.initialChapter,H.initialChapter=N,k(),$(".flashcards .image .img0").load(function(){_(),j()}),$(window).resize(function(){_()}).load(function(){_()}),$(".flashcards .image .img0").on("contextmenu",function(){return!1});$.ajax("flashcard_data.json").done(function(a){D=a.cardList.slice(),L||(P("indexing cards..."),u()),S(),r(),$(".flashcards .flip-img-layer").show(),z()}).fail(function(a){console.log("Failed to load flashcard_data.json: "+a),j()})}var B,N,F,M,q,D,E,J,L,V={},G=0,H={imageBasePath:"../images/",thumbBasePath:"../../art/shared/image_library/2013_kleiner/thmbs/",initialChapter:"all",activeCardProps:["artist","title","year","medium","dimensions","extended_caption"],cardPropDisplay:["artist","title","year","medium","dimensions","description"],externalInit:!1};return{initFlashcards:T}}();